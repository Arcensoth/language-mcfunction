---
name: mcfunction
scopeName: source.mcfunction
fileTypes:
  - mcfunction

variables:
  token_l: '(?<=\s)'
  token_r: '(?=\s)'
  resource_location: '(\#?)([a-z0-9\._\-]+)(\:)([a-z0-9\._\-\/]+)'
  range: '(-?\d*\.?\d+)?(\.\.)(-?\d*\.?\d+)?'
  number: '-?\d*\.?\d+'
  coordinate: '([\~\^])(-?\d*\.?\d+)?'
  literal: "[a-z0-9_]+"
  base_selector: '\@[a-z]'
  selector_key: '(\,?)({{literal}})(\=)(\!?)'

patterns:
  - include: "#comment"
  - include: "#command"

repository:
  comment:
    patterns:
      - name: comment.number-sign.mcfunction
        begin: '^\s*#'
        end: "$"

  command:
    patterns:
      - name: keyword.mcfunction
        begin: '^\s*{{literal}}'
        end: "$"
        patterns:
          - include: "#tokens"

  tokens:
    patterns:
      - include: "#token.selector_without_arguments"
      - include: "#token.selector_with_arguments"
      - include: "#token.resource_location"
      - include: "#token.range"
      - include: "#token.number"
      - include: "#token.relative_coordinate"
      - include: "#token.local_coordinate"
      - include: "#token.literal"

  token.selector_without_arguments:
    patterns:
      - name: entity.name.tag.mcfunction
        match: '{{token_l}}{{base_selector}}{{token_r}}'

  token.selector_with_arguments:
    patterns:
      - name: entity.name.tag.mcfunction
        begin: '{{token_l}}{{base_selector}}(\[)'
        end: '(\]){{token_r}}'
        # contentName: markup.bold.mcfunction
        beginCaptures:
          1:
            name: markup.bold.mcfunction
        endCaptures:
          1:
            name: markup.bold.mcfunction
        patterns:
          - include: "#selector_arguments"

  token.resource_location:
    patterns:
      - name: meta.token.resource_location.mcfunction
        match: "{{token_l}}({{resource_location}}){{token_r}}"
        captures:
          1:
            patterns:
              - include: "#resource_location"

  token.range:
    patterns:
      - name: meta.token.range.mcfunction
        match: "{{token_l}}({{range}}){{token_r}}"
        captures:
          1:
            patterns:
              - include: "#range"

  token.number:
    patterns:
      - name: meta.token.number.mcfunction
        match: "{{token_l}}({{number}}){{token_r}}"
        captures:
          1:
            patterns:
              - include: "#number"

  token.coordinate:
    patterns:
      - name: meta.token.coordinate.mcfunction
        match: "{{token_l}}({{coordinate}}){{token_r}}"
        captures:
          1:
            patterns:
              - include: "#coordinate"

  selector_arguments:
    patterns:
      - include: "#selector_argument.resource_location"
      - include: "#selector_argument.range"
      - include: "#selector_argument.number"
      - include: "#selector_argument.literal"

  selector.argument_key:
    patterns:
      - name: meta.selector.argument_key.mcfunction
        match: "{{selector_key}}"
        captures:
          1:
            name: markup.bold.mcfunction
          2:
            name: entity.name.tag.mcfunction
          3:
            name: comment.percentage.mcfunction
          4:
            name: keyword.control.mcfunction

  selector_argument.resource_location:
    patterns:
      - name: meta.selector_argument.resource_location.mcfunction
        match: "({{selector_key}})({{resource_location}})"
        captures:
          1:
            patterns:
              - include: "#selector.argument_key"
          6:
            patterns:
              - include: "#resource_location"

  selector_argument.range:
    patterns:
      - name: meta.selector_argument.range.mcfunction
        match: "({{selector_key}})({{range}})"
        captures:
          1:
            patterns:
              - include: "#selector.argument_key"
          6:
            patterns:
              - include: "#range"

  selector_argument.number:
    patterns:
      - name: meta.selector_argument.number.mcfunction
        match: "({{selector_key}})({{number}})"
        captures:
          1:
            patterns:
              - include: "#selector.argument_key"
          6:
            patterns:
              - include: "#number"

  selector_argument.literal:
    patterns:
      - name: meta.selector_argument.literal.mcfunction
        match: "({{selector_key}})({{literal}})"
        captures:
          1:
            patterns:
              - include: "#selector.argument_key"
          6:
            patterns:
              - include: "#literal"

  resource_location:
    patterns:
      - name: keyword.operator.mcfunction
        match: "{{resource_location}}"

  range:
    patterns:
      - name: constant.mcfunction
        match: "{{range}}"
        captures:
          2:
            # name: keyword.mcfunction
            # name: entity.name.function.mcfunction
            name: keyword.operator.mcfunction

  number:
    patterns:
      - name: constant.mcfunction
        match: "{{number}}"

  coordinate:
    patterns:
      - name: constant.mcfunction
        match: "{{coordinate}}"

  literal:
    patterns:
      - name: keyword.operator.mcfunction
        match: "{{literal}}"
